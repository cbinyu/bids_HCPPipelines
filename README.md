# bids_HCPPipelines
CBI's modifications to the [BIDS-App version of the HCP Pipelines](https://github.com/bids-apps/hcppipelines)

It includes a python file used to select the images that are used for Anatomical Pipeline (so that we don't use both normalized and un-normalized versions of the same run).  If you want, you can specify other ways of filtering the different files in that file.

It also has its own Dockerfile to copy the python file plus the scanner gradient coefficients file<sup>1</sup> into the Docker image, and it also modifies the `run.py` file to include a call to the filtering of the list of anatomical images.

Finally, it includes a bash script (`correct_qa_txt_files.sh`) that loops through all the `qa.txt` files generated by the Docker machine and modifies them so that the paths included in the files are not for the docker container file system, but relative to the subject folder.  So if you move the pre-processed data to a different folder/machine, you just need to cd to the subject folder level and just copy and paste the commands in the `qa.txt` files.

-----
## How to build the Docker image?

Clone or copy this repository to your local machine, cd to that folder, and run:

```
docker build -t <name-of-your-docker-image> .
```

(Note the dot (`.`) at the end of the command.)

-----
## Running the code

To run the pipelines on your BIDS-organized data, for a single subject:

```
dataDir=<path-to-your-BIDS-organized-study>
outDir=<where-you-want-your-pre-processed-images>
subjectID=01

docker run --rm -v ${dataDir}:/data:ro \
    -v ${outDir}:/out \
    <name-of-your-docker-image> \
        /data \
        /out \
        participant \
        --participant_label ${subjectID} 
        --license_key LICENSE_KEY
```
(For more information on the options for the pipelines, see the [BIDS-App version of the HCP Pipelines](https://github.com/bids-apps/hcppipelines)).


Now, to correct the paths in the `qa.txt` files generated by the pipelines, run:

```
. <path-to-your-local-copy-of-the-repository>/correct_qa_txt_files.sh \
  ${outDir}/sub-${subjectID}
```

(Note the dot (`.`) and space at the beginning of the command.)

______
<sup>1</sup> The gradient coefficients file is not included in this distribution, since it is
Siemens proprietary information.
